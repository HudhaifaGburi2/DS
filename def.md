# أهم التعاريف والملخص للمقدمة

## التعاريف الأساسية

### 1. **الذرية (Atomicity)**
العملية إما تنجح **كاملة** أو تفشل **كاملة**. لا يوجد حالة وسطية "نصف نجاح". مثال: عند تحويل مبلغ مالي، إما يُخصم من حساب ويُضاف للآخر معاً، أو لا شيء يحدث.

### 2. **الديمومة (Durability)**
البيانات المحفوظة تبقى **دائماً** حتى لو انقطع التيار الكهربائي أو تعطل الجهاز. لا تُفقد البيانات المؤكدة أبداً.

### 3. **fsync**
أمر نظام يُجبر نظام التشغيل على **كتابة جميع البيانات المؤقتة** من الذاكرة إلى القرص الصلب فوراً. هذا يضمن الديمومة.

### 4. **B-tree / B+tree**
هيكل بيانات شجري **متوازن ومُحسّن** للعمل على القرص الصلب. يسمح بالبحث والإدخال والحذف بكفاءة عالية. جميع قواعد البيانات التقليدية تستخدمه.

### 5. **LSM-tree (Log-Structured Merge-tree)**
هيكل بيانات بديل لـB-tree، مُحسّن للكتابة السريعة. يُستخدم في قواعد بيانات مثل Cassandra وRocksDB.

### 6. **KV Store (مخزن المفتاح-القيمة)**
قاعدة بيانات بسيطة تخزن البيانات كـ**أزواج (مفتاح ← قيمة)**. مثل قاموس أو Hash Map لكن على القرص وبترتيب مُرتب.

### 7. **OLTP (Online Transaction Processing)**
قواعد بيانات للتطبيقات اليومية (مثل تطبيقات البنوك، المتاجر الإلكترونية). تتميز بـ:
- استعلامات سريعة
- بيانات صغيرة لكل استعلام
- تستخدم فهارس كثيرة

### 8. **OLAP (Online Analytical Processing)**
قواعد بيانات للتحليلات والتقارير. تتميز بـ:
- استعلامات معقدة على بيانات ضخمة
- لا تهتم بالسرعة كثيراً
- تستخدم للتقارير الشهرية، تحليل البيانات

### 9. **Storage Engine (محرك التخزين)**
الطبقة السفلية من قاعدة البيانات التي تتعامل مع القرص مباشرة. SQL تُبنى **فوق** محرك التخزين.

### 10. **Free List (القائمة الحرة)**
قائمة تتتبع المساحات **الفارغة** في ملف قاعدة البيانات، حتى يمكن إعادة استخدامها بدلاً من توسيع الملف دائماً.

### 11. **Crash Recovery (الاسترداد من الأعطال)**
عملية استعادة قاعدة البيانات لحالة **صحيحة ومتسقة** بعد انقطاع مفاجئ للكهرباء أو عطل في النظام.

### 12. **Concurrency Control (التحكم بالتزامن)**
آليات تسمح لعدة مستخدمين بالقراءة والكتابة في نفس الوقت **دون تعارض** أو فساد البيانات.

---

## ملخص المقدمة

### الفكرة الرئيسية
بناء قاعدة بيانات كاملة من الصفر في **3000 سطر فقط** من كود Go، لفهم المبادئ الأساسية بالممارسة.

### لماذا هذا الكتاب؟
1. **التعلم بالممارسة**: "ما لا أستطيع بناءه، لا أفهمه" - فاينمان
2. **تجنب المصطلحات المربكة**: أدبيات قواعد البيانات مليئة بمصطلحات متضاربة
3. **حجم قابل للإدارة**: قواعد البيانات الحقيقية ضخمة جداً (SQLite = ميغابايتات من الكود!)
4. **المبادئ وليس التفاصيل**: التركيز على الأساسيات التي تبنى عليها كل قاعدة بيانات

### المواضيع الأربعة الرئيسية

#### **الموضوع 1: الديمومة والذرية**
- قاعدة البيانات ≠ مجرد ملف
- الفرق: الملفات العادية تفقد البيانات عند انقطاع الكهرباء
- الحل: استخدام `fsync` + آليات الاسترداد من الأعطال
- **المبدأ**: كل شيء أو لا شيء (Atomicity)

#### **الموضوع 2: هياكل بيانات الفهرسة**
- القرص الصلب **أبطأ 1000 مرة** من الذاكرة!
- لذلك نحتاج هياكل بيانات خاصة: **B+tree** أو **LSM-tree**
- التحديات:
  - اختيار الهيكل المناسب
  - التحديث التدريجي مع الحفاظ على الذرية
  - السماح بالتزامن (عدة مستخدمين في نفس الوقت)

#### **الموضوع 3: قاعدة بيانات علائقية فوق KV**
- **SQL ليست أساسية**، إنها مجرد واجهة مستخدم
- الأساس الحقيقي: **محرك التخزين (KV Store)**
- البناء على طبقات:
  1. الطبقة السفلى: KV (مفتاح ← قيمة)
  2. الطبقة الوسطى: جداول وفهارس
  3. الطبقة العليا: SQL

#### **الموضوع 4: لغة الاستعلام**
- بناء محلل (Parser) ومُفسّر (Interpreter)
- الأداة الوحيدة: **التكرار (Recursion)**
- يمكن تطبيق نفس المبدأ على أي لغة برمجة

### خارطة الطريق (3000 سطر)

| الأسطر | الخطوة |
|--------|--------|
| 366 | بناء B+tree |
| 601 | KV بسيط (إضافة فقط) |
| 731 | KV عملي (مع إدارة المساحة) |
| 1107 | إضافة الجداول |
| 1294 | استعلامات النطاق |
| 1438 | الفهارس الثانوية |
| 1461 | واجهات المعاملات |
| 1702 | التحكم بالتزامن |
| 2795 | لغة استعلام كاملة |

### الرسالة الأساسية
قواعد البيانات المعقدة **ليست سحراً**. إنها مبنية على **بضعة مبادئ بسيطة** يمكن لأي مبرمج فهمها وبناؤها بنفسه!